pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
--please phone home
--by skimmedfroth

function _init()
	make_player()
	map_setup()

	game_win=false
	game_over=false

end

function _update()
	if(not game_over) then
		update_map()
		move_player()
		check_win_lose()
	else
		if (btn(❎)) extcmd("reset")
	end
end

function _draw()
	cls()
	if (not game_over) then
		draw_map()
		draw_player()
		if (btn(❎)) show_inventory()
	else
		draw_win_lose()
	end
end
-->8
--map code

function map_setup()
	--timers
	timer=0
	anim_time=30 --30 = 1 second
	
	--map title settings
	wall=0
	card=1
	door=2
	anim1=3
	anim2=4
	lose=6
	win=7
end

function update_map()
	if (timer<0) then
		toggle_tiles()
		timer=anim_time
		end
		timer-=1
end


function draw_map()
	mapx=flr(p.x/16)*16
	mapy=flr(p.y/16)*16
	camera(mapx*8,mapy*8)
	
	map(0,0,0,0,128,64)

end

function is_tile(tile_type,x,y)
	tile=mget(x,y)
	has_flag=fget(tile,tile_type)
	return has_flag
end

function can_move(x,y)
	return not is_tile(wall,x,y)
end

function swap_tile(x,y)
	tile = mget(x,y)
	mset(x,y,tile+1)
end

function unswap_tile(x,y)
	tile = mget(x,y)
	mset(x,y,tile-1)
end

function get_card(x,y)
	p.cards+=1
	swap_tile(x,y)
	sfx(3)
end

function open_door(x,y)
	p.cards-=1
	swap_tile(x,y)
	sfx(1)
end
-->8
--player code

function make_player()
	p={}
	p.x=2
	p.y=3
	p.sprite=1
	p.cards=0
end

function draw_player()
	spr(p.sprite,p.x*8,p.y*8)
end

function move_player()
	newx=p.x
	newy=p.y
	
	if (btnp(⬅️)) newx-=1
	if (btnp(➡️)) newx+=1
	if (btnp(⬆️)) newy-=1
	if (btnp(⬇️)) newy+=1
	
	interact(newx,newy)
	
	if (can_move(newx,newy)) then
		p.x = mid(0,newx,127)
		p.y = mid(0,newy,63)
	else
		sfx(4)
	end
end

function interact(x,y)
	if (is_tile(card,x,y)) then
		get_card(x,y)
	
	elseif (is_tile(door,x,y) and p.cards>0) then
		open_door(x,y)
	end
end
-->8
--inventory code
function show_inventory()
	invx=mapx*8+40
	invy=mapy*8+8
	
	rectfill(invx,invy,invx+48,invy+24,0)
	print("invetory",invx+7,invy+4,7)
	print("cards "..p.cards,invx+12,invy+14,9)
	
end
-->8
--animation code

function toggle_tiles()
	for x=mapx,mapx+15 do
		for y=mapy,mapy+15 do
			if(is_tile(anim1,x,y)) then
				swap_tile(x,y)
			sfx(2)	
			elseif (is_tile(anim2,x,y)) then
				unswap_tile(x,y)
			sfx(2)
			end
		end
	end
end
-->8
--win/lose code

function check_win_lose()
 if (is_tile(win,p.x,p.y)) then
 	game_win=true
 	game_over=true
 elseif (is_tile(lose,p.x,p.y)) then
 	game_win=false
 	game_over=true
 end
end

function draw_win_lose()
	camera()
	if(game_win) then
		print([[			good job! 
		you managed to contact 
				for help!]],10,54,7)
	else
		print([[			mission failed. 
		you did not contact 
			earth in time.]],10,54,7)
	end
	print("press ❎ to try again",20,72,5)
end		
__gfx__
0000000000775500ddddddddddddddddd555555dd555555d00000000888888880000000000000000000000000000000000000000000000000000000000000000
0000000000751150dddddddddddddddddd5555dddd5555dd000000008d9999d80000000000000000000000000000000000000000000000000000000000000000
0070070005751150ddddddddddddddddddd88ddddddddddd0000000089dddd980000000000000000000000000000000000000000000000000000000000000000
0007700055775570dc87977dddddddddddd88ddddddddddd000000008dd99dd80000000000000000000000000000000000000000000000000000000000000000
00077000577c8777dc87977dddddddddddd88ddddddddddd000000008d9dd9d80000000000000000000000000000000000000000000000000000000000000000
0070070057777777d777997dddddddddddd88ddddddddddd000000008dddddd80000000000000000000000000000000000000000000000000000000000000000
0000000055777770d777797ddddddddddd5555dddd5555dd000000008dd99dd80000000000000000000000000000000000000000000000000000000000000000
0000000000500050ddddddddddddddddd555555dd555555d00000000888888880000000000000000000000000000000000000000000000000000000000000000
11111111dddddddd7777777777777777777777776996777777776996777777776996777766666666666666667777699600000000000000000000000000000000
11111111dddddddd7777777777777777777777776996777777776996777777776996777766666666666666667777699600000000000000000000000000000000
11111111dddddddd6666666666666666666677776996777777776996777766666996777766666666666666666666699600000000000000000000000000000000
11111111dddddddd9999999966666666999677776996777777776996777769999996777799999999999999969999999600000000000000000000000000000000
11111111dddddddd9999999966666666999677776996777777776996777769999996777799999999999999969999999600000000000000000000000000000000
11111111dddddddd6666666666666666699677776996777777776996777769966666777766666666666669966666666600000000000000000000000000000000
11111111dddddddd6666666666666666699677776996777777776996777769967777777777777777777769966666666600000000000000000000000000000000
11111111dddddddd6666666666666666699677776996777777776996777769967777777777777777777769966666666600000000000000000000000000000000
11111111000000007777777755555555550000550000000066666666777769966996777766666666000000000000000000000000000000000000000000000000
11111711000000007777777756655665550000550000000066666666777769966996777766666666000000000000000000000000000000000000000000000000
11111111000000007777777756655665550000550000000066666666777769966996666666666666000000000000000000000000000000000000000000000000
11111111000000007777777756658665550000c50000000099999996777769996999999969999999000000000000000000000000000000000000000000000000
11111111000000007777777755557555550000750000000099999996777769996999999969999999000000000000000000000000000000000000000000000000
11111111000000007777777756655665550000550000000066666996777766666666666669966666000000000000000000000000000000000000000000000000
11111111000000007777777756655665550000550000000077776996777777776666666669967777000000000000000000000000000000000000000000000000
11111111000000007777777755555555550000550000000077776996777777776666666669967777000000000000000000000000000000000000000000000000
00000000ddddddddd555555dddddd5c55c5ddddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ddddddddd566665dddddd585585ddddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000006dddddddd555555dddddd555555ddddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000006f777777d566665dddddd555555ddddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000066666666d555555ddd666577775666dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000066666666d556655ddd555577775555dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000006dddddd6d555555ddd555555555555dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000006dddddd6d555555ddd555555555555dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333ddddddd55ddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333ddddddd55ddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33b33333ddddddd55ddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
333b3333ddddddd55ddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
333b3333ddddddd55ddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333ddddddd55ddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
333333b3ddddddd55ddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333b33ddddddd55ddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dddddddd5555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dddddddddddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dddddddddddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dddddddddddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dddddddddddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dddddddddddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dddddddddddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000055555555dddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
01010101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000
__gff__
0000020048100080000000000000000000000101010101010101010100000000000001050000010101010000000000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1010101020101010101020101010101010101010101010101010101010101010101010101010101010101010101010101010101020101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1017121212121212121212121212121410101010101010102020101010201010101020101010101020201010102010101712121212121212121212121212121410101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1016111111111104111111111111111510101010101010101010101010102010101010101020101010101010101010101611515151021151511111515111031510101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1016111111111105111111111111021510101010101010101010102020101010201010201020101020101020101010101641404040424140404241404042111510101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1016111111111104111111111111111510101010101010201010201010101010101010101010101010202010101010101641404040424140404241404042111510101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1016111111111105111111111111111510101010101010101010101017121212121212121212121212121212121212121b11525252111152521111525211111510101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
102719191919191919191919191a231510101010101010101010101016321103111111111111111104111111230511111111515151111151511111515111111510101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
101010101010101010101010101611151010171212121212121212121b111103111111111111111122191919192211111141404040424140404241404042111510101712121212121212121214101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1017121212121212121410201016111510101611041105111111231102111103111111111111111122121212122211111141404040424140404241404042111510101634111133113411113315101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1016111111111111111510101016111510101611291926112919191919191926321111111111111105111111230411111111525252111152521111525211111510101611111111111111111115101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1016113211321132111510101016111510101611151016111503030303030327191919191919191919191919191919191a11111111111111111111111111111510101634111111111111073315101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
101611111111111111281212121b1115101016111510161115032919191a0315101010101010101010101010101010101611515151111151511111515111111510101611111111111111111115101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1016113211321132111104111111111510101611151016111503151010160315101010201010101010101010101010101641404040424140404241404042111510101634111133113411113315101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1016111111111111111105111111112812121b111510161115031510171b0315101010101010101010201020101010101641404040424140404241404042111510102719191926232919191918101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1016021111111111111104111111112311110411151016110411151016020315101010101010101010102010101010101611525252111152521111525211111510101010101016111510101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1027191919191919191919191919191919191919181027191919181027191918101010101010101010102010101010102719191919261111291919191919191810101010101016111510101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010201010101010101010101010101010101010101010101010201010161111151010101010101010101010101016111510101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010102010101010101010101010101010101010101010101010101010101010101010101010161111151010101010101010101010101016111510101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010102010101010101010101010101010101010101010101010101010101010161111151010101010101010101010101016111510101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010102010101010102010101010101010101010101010101010101010101010101010101010101010161111151010101010101010101010101016111510101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010201010101010101010101010101010101010101010101010101010101010101010161111151010101010101010101010101016111510101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
101010101010101010101010101010101010101010101020102010101010101010101010101010101010101010101010101010101016111115101010101010101010171212121b232812121214101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101020201010101010101010101010101010101010101010101010101010101010101010161111151010101010101010101634021133113411113315101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010102010101010101010101010101010101010101010101010101010101010101010101010101010161111151010101010101010101611111111111111111115101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010102010101010101010101010101010101010101010101010101010101010161111151010101010101010101634111111111111113315101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010161111281212121212121212121b11111111111111111115101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010102010101010101010101010101010101010101010101010101010101010101010101010161111110411231111041103030403031133113411023315101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010201010101020101010101010101010101010101010101010101010271919191919191919191919191919191919191919191918101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101020101010201010101010101010101010201010101010101020101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010102010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000300001015011150131501515017150191501e15022150251502a1302c1302f1300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000600001c3501c3501c3502935000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00040000277502775027750297502e750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000600000f04000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
